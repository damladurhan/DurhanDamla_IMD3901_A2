<!DOCTYPE html>
<html>
    <head>
      <title>Hello, WebVR! - A-Frame</title>
      <meta name="description" content="Hello, WebVR! - A-Frame">
      <!--  note we are using 1.1.0 as most recent -->
      <script src="/js/aframe.min.js"></script>
      <script src="js/aframe-environment-component.min.js"></script>
      <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
      <script src="https://unpkg.com/super-hands@^2.1.0/dist/super-hands.min.js"></script>
      <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
      <script src="http://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
      <script src="js/spinning-effect.js"></script>

      <link rel="stylesheet" href="css/user-gesture.css">

      <script>
        AFRAME.registerComponent('instantiate', {
            init: function(){
              let el = this.el;
          
              this.addMarker = function(e){
                //let p = e.detail.intersection.point;
                let scene = document.querySelector('a-scene');

                let newMark = document.createElement('a-entity');
                //newMark.setAttribute('geometry', {primitive: 'triangle'});
                newMark.setAttribute('id', 'sculpture');
                newMark.setAttribute('response-type', 'arraybuffer');
                //newMark.setAttribute('src', 'assets/models/madona_sculpture/scene.gltf')
                newMark.setAttribute('gltf-model', '#pyramid')
                newMark.setAttribute('material', 'color: #E4B056');
                //newMark.setAttribute('material', 'side:double');
                newMark.setAttribute('position', "1 1 0");
                newMark.setAttribute('scale', '.001 .001 .001');
                newMark.setAttribute('grabbable', {});
                newMark.setAttribute('droppable', {});
                scene.appendChild(newMark);

                console.log("instantiate ols");
                }
          
                this.el.addEventListener('click', this.addMarker);
              },
              remove: function(){
                this.el.removeEventListener('click', this.addMarker);
              }
          });

                const onClick = (event) => {
                        if(event.srcElement.id == "sculpture"){
                          console.log("bye whore hate u");
                          event.srcElement.parentElement.removeChild(event.srcElement);
                              }
                    }
                    window.addEventListener('click', onClick);


                    AFRAME.registerComponent('KillMe', {
                          init: function() {
                            var el = this.el;
                            el.addEventListener("collidestart", function (e) {
                              el.setAttribute('material', 'color: orange');
                              el.setAttribute('ammo-body', 'type:kinematic;');
                            });
                          }
                        });

        AFRAME.registerComponent('target-marker', {
          init:function() {
            let el = this.el;

            this.addMarker = function(e){
              let p = e.detail.intersection.point;
              let scene = document.querySelector('a-scene');

              let newMark = document.createElement('a-entity');
              newMark.setAttribute('geometry', {primitive:'sphere'});
              newMark.setAttribute('material', 'color:red');
              newMark.setAttribute('scale', '.2 .2 .2');
              newMark.setAttribute('position', p);
              scene.appendChild(newMark);
            }

            this.el.addEventListener('click', this.addMarker); 
          },
          remove:function() {
            this.el.removeEventListener('click', this.addMarker);
          }
          
        })
          /* AFRAME.registerComponent('start-experience', {
              init : function() {
                    console.log('scene loaded');
                    document.querySelector('#user-gesture-button').style.display = 'block';
              }
          });

          const startExperience = function(){
              document.querySelector('#user-gesture-overlay').style.display = 'none';

              //start all ambient sounds
              const ambientSounds = document.querySelectorAll('.ambient-sound');
              ambientSounds.forEach(function(soundEntity){
                  soundEntity.components['sound'].playSound();
              });
          }; */


      </script>
    </head>
    <body>
      <!-- <a-scene renderer="colorManagement:true; physicallyCorrectLights: true;"> -->

      </a-scene>
        <!-- <div id="user-gesture-overlay">
            <div class="center">
                <button id="user-gesture-button" onclick="startExperience()">enter experience</button>
            </div>
        </div> -->


      <a-scene >
        <a-entity progressive-controls></a-entity>


          <a-assets timeout="18000">
              <img id="earth_img" src="assets\Earth.jpg" crossorigin="anonymous">
              <img id="earth_map" src="assets\2k_earth_daymap.jpg" crossorigin="anonymous">
              <a-asset-item id="mars_model" response-type="arraybuffer" src="assets/mars.glb"></a-asset-item>
              <a-asset-item id="sculpture_model" response-type="arraybuffer" src="assets/models/madona_sculpture/scene.gltf"></a-asset-item>
              <a-asset-item id="pyramid" response-type="arraybuffer" src="assets/models/pyramid_2.0/scene.gltf"></a-asset-item>
              <a-asset-item id="column" response-type="arraybuffer" src="assets/models/egyptian_papyrus_column/scene.gltf"></a-asset-item>
              <audio id="space_music" src="assets/SpaceMusic.mp3" preloads="auto" crossorigin="anonymous"></audio>  
          </a-assets>

        <a-entity camera wasd-controls look-controls position="0 1.8 7">
            <!-- <a-entity light="type:spot; castShadow:true; shadowMBias:-0.0005; angle:40; penumbra:0.1;" position="4 3 0"></a-entity> -->
            <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200, objects:.interactive;"></a-entity>
            <a-cursor intersection-spwan="event:click; mixin:vovel"></a-cursor>
        </a-entity>
      

          <a-entity class="ambient-sound" sound="src:#space_music; autoplay:false;"></a-entity>  

          
      <!--
          <a-box color="red" position="-1.5 1.5 7" clickable 
              event-set__start="_event:grab-start; _target:#green; material.color:rgb(255, 0, 0)"
              event-set__end="_event:grab-end; _target:#green; material.color:rgb(0, 255, 0)">
          </a-box>

          <a-box id="green" color="green" position="-1.5 3 7" grabbable></a-box>

          <a-box id="yellow" color="yellow" position="-2 3 7" draggable event-set__drag="_event: drag-drop; _target: #pls; material.color: red"></a-box>

          <a-sphere id="blue" color="blue" radius="0.3" position="-5 3 7"  droppable target-marker></a-sphere>
        
        -->

          
      
        <a-entity id="room">
            <a-entity class="ground" geometry="primitive:plane; width:30; height:30;"  visible="false" material="color:white;" position="0 0.5 0" rotation="-90 0 0" shadow="cast:false; recieve:true;"></a-entity>
            <a-entity id="walls">
              <a-entity grabbable id="lightSphere" geometry="primitive:sphere" material="color:white; shader:flat" light="type: point" position="-40 15 -4" stroke="color:yellow;"></a-entity>
            </a-entity>
        </a-entity>  

      
      


                </a-entity>

        </a-entity>

       <!-- Button Sunrise-->
        <a-entity id="universal button" position="0 0.5 10" shadow >
            <a-entity class="button interactive" position="0 .7 0" spinning-effect="90" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255,100,100)" shadow
            animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200;"
            animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200;"
            animation__click="property:position.y; to:.7; from:0.65; type:color; startEvents:click; dur:300;"></a-entity>
            <a-entity gltf-model="#column" position="0 0.3 0" scale=".2 .1 .2" shadow></a-entity>
        </a-entity>


        <!-- Button Instantiate-->
        <a-entity id="instantiate button" position="2 0.5 10" shadow instantiate>
          <a-entity class="button interactive" position="0 0.7 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255,100,100)" shadow
          animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200;"
          animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200;"
          animation__click="property:position.y; to:0.7; from:0.65; type:color; startEvents:click; dur:300;"></a-entity>
          <a-entity gltf-model="#column" position="0 0.3 0" scale=".2 .1 .2" shadow></a-entity>
      </a-entity>
        <a-entity environment="preset:egypt;"></a-entity>
        </a-scene>  
    </body>
</html>